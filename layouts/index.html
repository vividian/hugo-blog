{{- define "main" -}}
{{- $recent := first 10 (sort .Site.RegularPages "Date" "desc") -}}
{{- $popularRaw := site.Data.popular | default (slice) -}}
{{- $topSix := first 6 $popularRaw -}}
{{- $popularData := first 5 (where $topSix "page_title" "ne" "검색") -}}
<div class="wrapper list-page">
    <header class="header">
        {{/*
            <h1 class="header-title center">최근 글</h1>
        */}}
        {{ partial "section-intro.html" . }}
    </header>
    <h3 class="posts-item-note" aria-label="Recent Posts">최근 글</h3>
    <main class="page-content" aria-label="Content">
        {{ range $recent }}
        {{ partial "postCard" . }}
        {{ end }}
        <p>
            <a href="https://vividian.net/all"> 전체 글 보기</a>
        </p>
    </main>
    <p></p>
    {{- if gt (len $popularData) 0 }}
    <section class="popular-posts">
        <h3 class="posts-item-note" aria-label="Popular Posts">인기 글 (최근 28일)</h3>
        <div class="page-content popular-content" aria-label="Popular Content">
            {{- range $popularData }}
                {{- $path := .page_path -}}
                {{- $page := site.GetPage $path -}}
                {{- if not $page }}
                    {{- $page = site.GetPage (strings.TrimSuffix "/" $path) -}}
                {{- end -}}
                {{- if not $page }}
                    {{- $page = site.GetPage (strings.TrimPrefix "/" $path) -}}
                {{- end -}}
                {{- if $page -}}
                    {{ partial "popularCard.html" (dict "Page" $page "Views" .views) }}
                {{- else -}}
                    <!-- <article class="post-item post-item--popular"> -->
                    <article class="post-item">
                        <h4 class="post-item-title">
                            <a href="{{ $path }}">{{ .page_title | default $path }}</a>
                        </h4>
                        <div class="post-item-right">
                            <span class="post-item-meta">조회수 {{ .views }}</span>
                        </div>
                    </article>
                {{- end }}
            {{- end }}
        </div>
    </section>
    {{- end }}
</div>
{{- end -}}
